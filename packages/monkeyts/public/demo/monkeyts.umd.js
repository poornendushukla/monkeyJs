(function(h,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(h=typeof globalThis<"u"?globalThis:h||self,u(h.MonkeyJS={}))})(this,function(h){"use strict";var D=Object.defineProperty;var q=(h,u,f)=>u in h?D(h,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[u]=f;var a=(h,u,f)=>q(h,typeof u!="symbol"?u+"":u,f);function u(n){!n||f(n)||n.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})}function f(n){const t=n.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function N(){const n=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),t=window.innerHeight;return n>t}function A(){const n=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),t=window.innerWidth;return n>t}function M(n,t=5e3){try{const e=document.querySelector(n);if(!e)throw new Error("element not found in dom, wait for it to appear within timeout");return Promise.resolve(e)}catch{return new Promise((o,i)=>{const s=new MutationObserver(()=>{const r=document.querySelector(n);r&&(s.disconnect(),o(r))});s.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{s.disconnect(),i(`Element with the selector ${n} not found within timeout `)},t)})}}function P(n,t=10){let e;return function(){clearTimeout(e),e=setTimeout(()=>n(),t)}}var d=(n=>(n.POPOVER_WRAPPER_ID="popover_wrapper_id",n.POPOVER_ELEMENT="popover_element",n.POPOVER_TITLE="popover_title",n.POPOVER_DESC="popover_desc",n.NEXT_BTN="next_btn",n.HEADER="header",n.POPOVER_CLOSE_BTN="popover_close_btn",n.PREV_BTN="prev_btn",n.POPOVER_FOOTER="popover_footer",n.POPOVER_PROGRESSBAR="popover_progress",n))(d||{}),c=(n=>(n.TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n))(c||{});const k=["top","bottom","left","right"],T={fontFamily:"Arial, sans-serif",fontSize:"14px",textColor:"#333",popoverBgColor:"#fff",popoverPadding:"10px",popoverBorderRadius:"8px",popoverBoxShadow:"0 2px 5px rgba(0, 0, 0, 0.2)",popoverBtnPadding:"5px 16px",overlayColor:"rgba(0,0,0,0.5)",overlayRadius:"10px",overlayOpacity:.5,overlayPadding:"10px",ovelayStrokeColor:"rgba(255, 0, 0, 0)",overlayStrokeWidth:2,primaryBtnBgColor:"#007BFF",primaryBtnColor:"#FFFFFF",secondaryBtnColor:"#FFFFFF",secondaryBtnBgColor:"#6C757D",baseZIndex:1e3,overlayZIndex:99,arrowColor:"white"},F={fadeInUp:`{

    0%{
      opacity:0;
    }

    to{
      opacity: 1; /* End fully visible */
      transform: translateY(0); /* End at original position */
    }  
  }
`,overlayFadeInUp:`{

    from {
      opacity:0;
      transform: translateY(10px);
    }

    to {
      opacity:1;  
      transform: translateY(0); /* End at original position */

    }

  }`},g=class g{constructor(t){a(this,"styleElement");a(this,"theme");a(this,"styles",new Map);a(this,"styleSheetMap",new Map);a(this,"customProperties",new Map);a(this,"animations",new Map);this.theme=t,this.styleElement=this.createStyle(),this.initializeCustomProperties(),this.initializeGlobalAnimations(),this.generateBaseStyles()}createStyle(){const t=document.createElement("style");return document.head.append(t),t}static overrideTheme(t){g.getInstance(t)}static getInstance(t=T){return g.instance||(console.log(T,t),g.instance=new g({...T,...t})),g.instance}generateBaseStyles(){this.addComponentStyles("mask",{base:`
        fill:var(--monkey-overlayColor);
        stroke:rgba(255, 0, 0, 0);
        stroke-width:2;
        `})}initializeCustomProperties(){for(const[t,e]of Object.entries(this.theme))this.customProperties.set(`--monkey-${t}`,e.toString());this.updateCustomProperties()}updateCustomProperties(){let t=`:root{
`;for(const[e,o]of this.customProperties)t+=` ${e}: ${o};
`;t+=`}
`,this.styleElement.textContent=t+this.styleElement.textContent}initializeGlobalAnimations(){for(const[t,e]of Object.entries(F))this.animations.set(`monkey-${t}`,e);this.updateCustomAnimations()}updateCustomAnimations(){let t="";for(const[e,o]of this.animations)t+=` @keyframes ${e} ${o}`;this.styleElement.textContent=t+this.styleElement.textContent}addComponentStyles(t,e){this.styles.has(t)||this.styles.set(t,new Map);const o=this.styles.get(t);for(const[i,s]of Object.entries(e))o==null||o.set(i,s);o&&this.styles.set(t,o),this.updateStyles()}updateStyles(){let t="";for(const[o,i]of this.styles)for(const[s,r]of i){const p=`.monkey-${s==="base"?o:`${o}-${s}`}`;this.styleSheetMap.has(p)||(t+=`${p} { ${r} }
`,this.styleSheetMap.set(p,r))}const e=this.styleElement.textContent+t;this.styleElement.textContent=e}updateTheme(t){this.theme={...t,...this.theme};for(const[e,o]of Object.entries(t))this.customProperties.set(`--monkey-${e}`,o.toString());this.updateCustomProperties()}getClassName(t,e="base"){return`monkey-${t}${e==="base"?"":"-"+e}`}getStaticCSS(){return this.styleElement.textContent||""}};a(g,"instance");let C=g;class x{constructor(t,e){this.styleManager=t,this.compnentName=e}addStyles(t){this.styleManager.addComponentStyles(this.compnentName,t)}getClassName(t="base"){return this.styleManager.getClassName(this.compnentName,t)}}class I{constructor(t){a(this,"_overlay");a(this,"_mask");a(this,"_padding");a(this,"_radius");a(this,"styleManger");a(this,"state",{isInitialized:!1,isMounted:!1,isVisible:!1});if(t){const{padding:e={top:10,left:10,right:10,bottom:10},radius:o}=t,i=C.getInstance();this.styleManger=new x(i,"overlay"),this._padding=e,this._radius=o}this.initialize()}initialize(){if(this.state.isInitialized){console.warn("Overlay already initialized");return}try{this.initializeStyles(),this.build(),this.state.isInitialized=!0}catch(t){throw console.error("Failed to initialize overlay",t),new Error("Failed to initialize overlay")}}initializeStyles(){this.styleManger.addStyles({base:`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: var(--monkey-overlayZIndex);
        overflow: hidden;
        fill-rule: evenodd;
        clip-rule: evenodd;
        stroke-linejoin: round;
        `,mask:`
        fill:var(--monkey-overlayColor);
        opacity:var(--monkey-overlayOpacity);
        stroke:var(--monkey-overlayStrokeColor);
        stroke-width:var(--monkey-overlayStrokeWidth);
      `,"mask-animate":`
        animation: monkey-overlayFadeInUp 0.5s ease forward;
      `})}build(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=this.styleManger.getClassName();t.setAttribute("class",e),t.setAttribute("id","overlayId"),this._overlay=t,this.buildMask()}buildMask(){const t=document.querySelector("#maskId");if(t){this._mask=t;return}const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("id","maskId");const o=this.styleManger.getClassName("mask");e.setAttribute("class",o),this._mask=e}cleanupAnimations(){const t=this.styleManger.getClassName("mask-animate");setTimeout(()=>{var e;(e=this._overlay)==null||e.classList.remove(t)},1e3)}applyAnimations(){var e;const t=this.styleManger.getClassName("mask-animate");(e=this._overlay)==null||e.classList.add(t),this.cleanupAnimations()}removeDocumentReferences(){this._mask=null,this._overlay=null}resetState(){this.state={isInitialized:!1,isMounted:!1,isVisible:!1}}appendOverlayToDocument(){this._overlay&&document.body.appendChild(this._overlay)}removeOvelayFromDocument(){this._overlay&&this._overlay.remove()}createSvgPathWithCutout(t){const e={x:0,y:0,width:window.innerWidth,height:window.innerHeight},{x:o,y:i,width:s,height:r}=e,{x:l,y:p,width:v,height:b}=t,{top:E=0,right:S=0,bottom:_=0,left:$=0}=this._padding||{},y={x:l-$,y:p-E,width:v+$+S,height:b+E+_},H=`M${o},${i}H${s}V${r}H${o}V${i}Z`;let B;return this._radius&&this._radius>0?B=`M${y.x},${y.y+this._radius}a${this._radius},${this._radius} 0 0 1 ${this._radius},${-this._radius}h${y.width-2*this._radius}a${this._radius},${this._radius} 0 0 1 ${this._radius},${this._radius}v${y.height-2*this._radius}a${this._radius},${this._radius} 0 0 1 ${-this._radius},${this._radius}h${-y.width+2*this._radius}a${this._radius},${this._radius} 0 0 1 ${-this._radius},${-this._radius}v${-y.height+2*this._radius}Z`:B=`M${y.x},${y.y}h${y.width}v${y.height}h${-y.width}Z`,`${H}${B}`}update(t){var i;const e=(i=this._overlay)==null?void 0:i.style.display,o=this.createSvgPathWithCutout(t);if(e&&e==="none"&&this.mount(),this._mask||this.buildMask(),this._overlay&&this._mask){let s;this._overlay.querySelector("#maskId")?(s=this._overlay.querySelector("#maskId"),s&&s.setAttribute("d",o)):(this._overlay.appendChild(this._mask),s=this._overlay.querySelector("#maskId"),s&&s.setAttribute("d",o)),this.applyAnimations(),this._mask=s}}mount(){if(!this.state.isInitialized){console.error("Overlay not initialize");return}try{if(this.state.isMounted){console.warn("Overlay already mounted");return}this.appendOverlayToDocument(),this.state.isMounted=!0,this.state.isVisible=!0}catch(t){throw console.error("Failed to mount overlay",t),new Error("Failed to mount overlay")}}unmount(){if(!this.state.isInitialized){console.error("Overlay is not initialized");return}try{if(!this.state.isMounted){console.warn("Overlay not mounted");return}this.removeOvelayFromDocument(),this.state.isMounted=!1,this.state.isVisible=!1}catch(t){throw console.error("Failed to unmount Overlay",t),new Error("Failed to unmoutn Overlay")}}distroy(){try{this.state.isMounted&&this.unmount(),this.resetState(),this.removeDocumentReferences()}catch(t){throw console.error("Failed to distroy overlay.",t),new Error("Failed to destroy overlay")}}get config(){return{padding:this._padding,radius:this._radius}}}class O extends EventTarget{constructor(){super()}monkeyDispatch(t,e){const o=new CustomEvent(t,{detail:e});return window.dispatchEvent(o)}onNextEvent(t){this.monkeyDispatch("onNext",t||{})}onPrevEvent(t){this.monkeyDispatch("onPrev",t||{})}onEndEvent(t){this.monkeyDispatch("onEnd",t||{})}onStartEvent(t){this.monkeyDispatch("onStart",t||{})}onResize(t){this.monkeyDispatch("onResize",t||{})}onScroll(t){this.monkeyDispatch("onScroll",t||{})}}class L{constructor({steps:t}){a(this,"_stepsComponent",[]);a(this,"currentStep",0);a(this,"isTourActive",!1);a(this,"isTourStarted",!1);this._stepsComponent=t,this.isTourActive=!0}async init(){if(this._stepsComponent&&this._stepsComponent.length===0){console.warn("No steps defined");return}if(this.isTourStarted=!0,!this.checkConditionForCurrentStep()){await this.incrementSteps();return}await this.executeCurrentStepAction()}async executeCurrentStepAction(){var e;const t=(e=this._stepsComponent[this.currentStep])==null?void 0:e.action;t&&await t()}checkConditionForCurrentStep(){const t=this._stepsComponent[this.currentStep];let e=!0;return t.condition&&(e=t.condition()),e}async incrementSteps(){for(;this.currentStep<this._stepsComponent.length&&(this.currentStep=this.currentStep+1,!this.checkConditionForCurrentStep()););if(this.currentStep>=this._stepsComponent.length)throw new Error("Exhausted steps, endtour");await this.executeCurrentStepAction(),Promise.resolve(this.currentStep)}async decrementSteps(){for(;this.currentStep>=0&&(this.currentStep=this.currentStep-1,!this.checkConditionForCurrentStep()););if(this.currentStep<0)throw new Error("Exhausted steps, endtour");await this.executeCurrentStepAction(),Promise.resolve(this.currentStep)}refreshTour(t){const e=t.getBoundingClientRect();console.log(e)}addStepsEnd(t){this._stepsComponent.push(...t)}endTour(){this.isTourActive=!1,this._stepsComponent=[]}}const w=class w{constructor({steps:t}){a(this,"tourState");a(this,"eventEmitter");a(this,"eventListeners",[]);this.tourState=new L({steps:t}),this.eventEmitter=new O}removeEventListeners(){this.eventListeners.forEach(({element:t,type:e,handler:o})=>{t.removeEventListener(e,o)}),this.eventListeners=[]}addEventListenerWithCleanup(t,e,o){t.addEventListener(e,o),this.eventListeners.push({element:t,type:e,handler:o})}handleKeydown(t){t.key=="Escape"&&this.endTour()}setupEventListners(){this.addEventListenerWithCleanup(window,"keydown",t=>this.handleKeydown(t)),this.addEventListenerWithCleanup(window,"onNext",()=>this.onNext()),this.addEventListenerWithCleanup(window,"onPrev",()=>this.onPrev())}distroy(){this.tourState.endTour(),this.removeEventListeners(),w.instance=null}static initInstance({steps:t}){w.instance||(w.instance=new w({steps:t}),w.instance.setupEventListners())}static getInstance(){if(!w.instance)throw new Error("Tour is not initialized yet! try refreshingðŸ¤ž");return w.instance}async onNext(){try{await this.tourState.incrementSteps()}catch{this.endTour()}}async start(){if(this.tourState.isTourStarted)throw new Error("Tour is active, are you trying to start same tour multiple timesðŸ¤·â€â™‚ï¸....");await this.tourState.init(),this.eventEmitter.onStartEvent()}async onPrev(){try{await this.tourState.decrementSteps()}catch{this.endTour()}}onCancel(){this.endTour()}endTour(){this.eventEmitter.onEndEvent(),this.distroy()}get totalSteps(){return this.tourState._stepsComponent.length}get currentStep(){return this.tourState.currentStep}get isLastStep(){return this.tourState.currentStep===this.totalSteps-1}get isTourActive(){return this.tourState.isTourActive}get isTourStarted(){return this.tourState.isTourStarted}getCurrentStepContent(){if(this.tourState._stepsComponent[this.tourState.currentStep])return this.tourState._stepsComponent[this.tourState.currentStep]}async getCurrentActiveStepElement(){if(this.tourState._stepsComponent[this.tourState.currentStep]){const t=`#${this.tourState._stepsComponent[this.tourState.currentStep].element}`;return await M(t)}}};a(w,"instance");let m=w;class z{constructor(t){a(this,"arrowElement");a(this,"styleManager");this.config=t;const e=C.getInstance();this.styleManager=new x(e,"popover-arrow"),this.initialize()}initializeStyles(){this.styleManager.addStyles({base:` width: 0;
        height: 0;
        position: absolute;
        border-style: solid;
        z-index: 1000;
        `,bottom:`border-width: 10px 10px 0 10px; /* Triangular shape pointing up */
        border-color: var(--monkey-arrowColor, white) transparent transparent transparent; /* Only top border is colored */
        bottom: -10px; /* Position at the top of the popover */
        left:  10px /* Center horizontally */`,top:` border-width: 0 10px 10px 10px; /* Triangular shape pointing down */
        border-color: transparent transparent var(--monkey-arrowColor, white) transparent; /* Only bottom border is colored */
        top: -10px; /* Position at the bottom of the popover */
        left: 10px; /* Center horizontally */`,right:` border-width: 10px 0 10px 10px; /* Triangular shape pointing right */
        border-color: transparent transparent transparent var(--monkey-arrowColor, white); /* Only left border is colored */
        right: -10px; /* Position at the right side of the popover */
        top: calc(50% - 10px); /* Center vertically */`,left:`  border-width: 10px 10px 10px 0; /* Triangular shape pointing left */
        border-color: transparent var(--monkey-arrowColor, white) transparent transparent; /* Only right border is colored */
        left: -10px; /* Position at the left side of the popover */
        top: 10px; /* Center vertically */`})}buildArrow(){const{position:t=c.RIGHT}=this.config,e=document.createElement("div"),o=this.arrowMapping(t),i=this.styleManager.getClassName(),s=this.styleManager.getClassName(o);e.className=`${i} ${s}`,this.arrowElement=e}arrowMapping(t){switch(t){case c.TOP:return c.BOTTOM;case c.BOTTOM:return c.TOP;case c.LEFT:return c.RIGHT;case c.RIGHT:return c.LEFT}}initialize(){this.initializeStyles(),this.buildArrow()}distroy(){this.arrowElement=null}update(t){if(!this.arrowElement){console.error("Arrow not itialized");return}const{position:e}=t||this.config;k.forEach(s=>{var l,p;const r=this.styleManager.getClassName(s);(l=this.arrowElement)!=null&&l.classList.contains(r)&&((p=this.arrowElement)==null||p.classList.remove(r))});const o=this.arrowMapping(e),i=this.styleManager.getClassName(o);this.arrowElement.classList.add(i)}get arrow(){return this.arrowElement}}class R{constructor(t){a(this,"state",{isInitialized:!1,isMounted:!1,isVisible:!1,currentStep:0});a(this,"styleManager");a(this,"popoverElement");a(this,"arrowInstance");this.options=t;const e=C.getInstance();this.styleManager=new x(e,"popover"),this.initialize()}initialize(){if(this.state.isInitialized){console.warn("Popover Builder is initialized");return}try{this.initializeStyles(),this.build(),this.state.isInitialized=!0}catch(t){throw console.error("Failed to initialize popoverBuilder",t),new Error("Failed to initialize popoverBuilder")}}initializeStyles(){this.styleManager.addStyles({base:`
        display:flex;
        flex-direction: column;
        position: fixed;
        background-color: var(--monkey-popoverBgColor);
        border: 1px solid #ccc;
        border-radius: var(--monkey-popoverBorderRadius);
        box-shadow: var(--monkey-popoverBoxShadow);
        z-index: var(--monkey-baseZIndex);
        color:var(--monkey-textColor);
        font-family: var(--monkey-fontFamily);
        padding:var(--monkey-popoverPadding);
        gap:10px;
        `,animate:`
        opacity: 0; /* Start hidden */
        transform: translateY(10px); /* Start slightly down */
        animation: monkey-fadeInUp 0.8s forwards; /* Apply animation */
        `,footer:`
        display:flex;
        justify-content:space-between;
        align-items: baseline;
      `,header:`
        display:flex;
        align-items:baseline;
      `,title:`
        font-weight:700
      `,description:`
        inline-size:300px
      `,"progress-bar":`
      
      `,"next-btn":`
        background-color:var(--monkey-primaryBtnBgColor);
        color:var(--monkey-primaryBtnColor);
        padding: var(--monkey-popoverBtnPadding);
      `,"prev-btn":`
        background-color:var(--monkey-secondaryBtnBgColor);
        color:var(--monkey-secondaryBtnColor);
        padding: var(--monkey-popoverBtnPadding);
      `,"close-btn":`
        margin-left:auto;
        background-color:var(--monkey-popoverBgColor);
        color:var(--monkey-primaryBtnBgColor);
        padding: var(--monkey-popoverBtnPadding);
      `,"btn-wrap":`
        margin-left:auto;
        display:flex;
        gap:10px;
      `})}build(){this.state.isInitialized||this.createPopover()}removePopoverFromDocument(){this.state.isMounted||console.error("Popover not mounted, nothing to remove"),this.popoverElement.remove()}createElement(t,e={}){const o=document.createElement(t);return Object.assign(o,e),e.style&&Object.assign(o.style,e.style),o}createButton(t,e,o,i){return this.createElement("button",{innerText:t||e,className:o,id:i})}buildPopoverContent(){if(!this.popoverElement)return;const t=this.createElement("header",{id:d.HEADER,className:this.styleManager.getClassName("header")}),e=this.createElement("span",{id:d.POPOVER_TITLE,className:this.styleManager.getClassName("title")});if(t.appendChild(e),this.options.isCloseBtnVisible){const i=this.createButton(void 0,"x",this.styleManager.getClassName("close-btn"),d.POPOVER_CLOSE_BTN);t.appendChild(i)}const o=this.createElement("div",{id:d.POPOVER_DESC,className:this.styleManager.getClassName("description")});this.popoverElement.append(t,o)}buildFooter(){if(!this.popoverElement)return;const t=m.getInstance(),e=this.createElement("div",{id:d.POPOVER_FOOTER});if(e.classList.add(this.styleManager.getClassName("footer")),this.options.progressBar){const l=this.createElement("div",{id:d.POPOVER_PROGRESSBAR}),p=t.totalSteps,v=t.currentStep;l.innerHTML=`<span>${v+1} of ${p}</span>`,l.classList.add(this.styleManager.getClassName("progress-bar")),e.append(l)}const o=this.createElement("div"),i=this.styleManager.getClassName("btn-wrap");o.classList.add(i);const s=this.styleManager.getClassName("next-btn"),r=this.styleManager.getClassName("prev-btn");o.appendChild(this.createButton(this.options.prevBtnText,"Previous",r,d.PREV_BTN)),o.appendChild(this.createButton(this.options.nextBtnText,"Next",s,d.NEXT_BTN)),e.appendChild(o),this.popoverElement.append(e)}addArrow(){this.arrowInstance=new z({position:this.options.position}),this.popoverElement&&this.popoverElement.appendChild(this.arrowInstance.arrow)}createPopover(){this.popoverElement=this.createElement("div",{id:d.POPOVER_WRAPPER_ID}),this.popoverElement.classList.add(this.styleManager.getClassName()),this.createElement("div",{id:d.POPOVER_WRAPPER_ID,className:"popover-wrapper"}).appendChild(this.popoverElement),this.buildPopoverContent(),this.buildFooter(),this.options.isArrowVisible&&this.addArrow()}appendPopoverToDocument(){this.popoverElement&&document.body.appendChild(this.popoverElement)}updatePopoverContent(t,e,o,i){if(!this.popoverElement)return;const s=this.popoverElement.querySelector(`#${d.POPOVER_TITLE}`);s&&(s.classList.add(this.styleManager.getClassName("title")),s.innerText=t);const r=this.popoverElement.querySelector(`#${d.POPOVER_DESC}`);r&&(r.innerText=e);const l=this.popoverElement.querySelector(`#${d.POPOVER_PROGRESSBAR}`);l&&(l.innerHTML=`<span>${o+1} of ${i}</span>`)}markVisibiltyOfPopoverButtons(t,e,o){if(console.log(o),!this.popoverElement)return;const i=this.popoverElement.querySelector(`#${d.NEXT_BTN}`),s=this.popoverElement.querySelector(`#${d.PREV_BTN}`);e?i.innerText="Done":(i.innerText=this.options.nextBtnText||"Next",i.style.display="block"),t===0?s.style.display="none":s.style.display="block"}resetState(){this.state={isInitialized:!1,isMounted:!1,isVisible:!1,currentStep:0}}cleanupDomReferences(){this.popoverElement=null,this.arrowElement=null}get config(){return{position:this.options.position,offsetX:this.options.offsetX,offsetY:this.options.offsetY}}updateContent(t,e,o,i,s){this.updatePopoverContent(t,e,o,s),this.markVisibiltyOfPopoverButtons(o,i,s)}updatePosition(t){const{left:e,top:o,popoverPosition:i,width:s,height:r}=t;this.arrowInstance&&this.arrowInstance.update({position:i,left:e,top:o,width:s,height:r});const l=this.styleManager.getClassName("animate");this.popoverElement.classList.add(l),this.popoverElement.style.left=`${e}px`,this.popoverElement.style.top=`${o}px`,console.log("Popover position updated",o,e,t),setTimeout(()=>{this.popoverElement.classList.remove(l)},1e3)}destroy(){try{this.state.isMounted&&this.unmount(),this.cleanupDomReferences(),this.resetState()}catch(t){throw console.error("Failed to distroy popoverBuilder",t),new Error("Failed to distroy PopoverBuilder")}}mount(){if(!this.state.isInitialized)throw new Error("Cannot mount uninitialized PopoverBuilder");if(this.state.isMounted){console.warn("PopoverBuilder is already mounted");return}try{this.appendPopoverToDocument(),this.state.isMounted=!0,this.state.isVisible=!0}catch(t){throw console.error("Failed to mount the popover",t),new Error("Failed to mount the popover")}}unmount(){if(this.state.isMounted)try{this.removePopoverFromDocument(),this.state.isMounted=!1,this.state.isVisible=!1}catch(t){throw console.error("Failed to unmount the popover",t),new Error("Failed to unmount the popover")}}}class W{constructor(t){a(this,"popover");a(this,"overlay");a(this,"emitter");a(this,"eventListeners",[]);this.popover=new R(t),this.overlay=new I(t.overlayConfig),this.emitter=new O,this.setupWindowEventListners()}isPopoverOverFlowing(t,e){const o=this.popover.popoverElement.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight;return t<0||e<0||t+o.width>i||e+o.height>s}repositionPopover(t){const{position:e,offsetX:o,offsetY:i}=this.popover.config,{left:s,top:r}=this.calulatePosition(t,e,o,i);if(!this.isPopoverOverFlowing(s,r))return{left:s,top:r,popoverPosition:e};let l,p,v;return k.forEach(b=>{const{left:E,top:S}=this.calulatePosition(t,b,o,i);if(!this.isPopoverOverFlowing(E,S)){l=E,p=S,v=b;return}}),{left:l,top:p,popoverPosition:v}}calulatePosition(t,e,o,i){const s=this.popover.popoverElement.getBoundingClientRect(),{padding:r}=this.overlay.config;let l=t.left,p=t.top;const v=10,b=(r==null?void 0:r.top)??0,E=(r==null?void 0:r.bottom)??0,S=(r==null?void 0:r.left)??0,_=(r==null?void 0:r.right)??0;switch(e){case c.TOP:l=t.left+t.width/2-s.width/2,p=t.top-s.height-v-b,i=i?-Math.abs(i):0;break;case c.RIGHT:l=t.right+v+_,p=t.top+t.height/2-s.height/2,o=o?Math.abs(o):0;break;case c.LEFT:l=t.left-s.width-v-S,p=t.top+t.height/2-s.height/2,o=o?-Math.abs(o):0;break;case c.BOTTOM:l=t.left+t.width/2-s.width/2,p=t.bottom+v+E,i=i?Math.abs(i):0;break;default:l=t.left,p=t.top;break}return l+=o??0,p+=i??0,console.log("Popover position calculated",{left:l,top:p,offsetX:o,offsetY:i,position:e,tleft:t.left,ttop:t.top,popoverRect:s}),{top:Number(p),left:Number(l)}}updatePopoverPosition(t){if(this.popover.popoverElement){const{left:e,top:o,popoverPosition:i}=this.repositionPopover(t);this.popover.updatePosition({left:e,top:o,popoverPosition:i,width:t.width,height:t.height})}}async updateOverlayPosition(){const e=await m.getInstance().getCurrentActiveStepElement();if(e){const o=e.getBoundingClientRect();this.overlay.update(o)}}async updatePopover(){const t=m.getInstance(),e=t.getCurrentStepContent(),o=await t.getCurrentActiveStepElement();if(e&&o){u(o);const i=o.getBoundingClientRect(),{description:s,title:r}=e;this.overlay.update(i),this.popover.updateContent(r,s,t.currentStep,t.isLastStep,t.totalSteps),this.updatePopoverPosition(i)}}removeEventListeners(){this.eventListeners.forEach(({element:t,type:e,handler:o})=>{t.removeEventListener(e,o)}),this.eventListeners=[]}addEventListenerWithCleanup(t,e,o){t.addEventListener(e,o),this.eventListeners.push({element:t,type:e,handler:o})}handleNextBtnClick(){this.emitter.onNextEvent(),this.updatePopover()}handlePrevBtnClick(){this.emitter.onPrevEvent(),this.updatePopover()}handleEndTour(){this.distroy()}setupPopoverBtnListeners(){const t=document.querySelector(`#${d.NEXT_BTN}`),e=document.querySelector(`#${d.PREV_BTN}`),o=document.querySelector(`#${d.POPOVER_CLOSE_BTN}`),i=P(this.updatePopover.bind(this)),s=P(this.updateOverlayPosition.bind(this));this.addEventListenerWithCleanup(window,"resize",()=>i()),this.addEventListenerWithCleanup(window,"scroll",()=>s()),this.addEventListenerWithCleanup(window,"onEnd",()=>{this.handleEndTour()}),this.addEventListenerWithCleanup(window,"keydown",r=>{switch(r.key){case"ArrowLeft":this.handlePrevBtnClick();break;case"ArrowRight":this.handleNextBtnClick();break}}),t&&this.addEventListenerWithCleanup(t,"click",()=>{this.handleNextBtnClick()}),e&&this.addEventListenerWithCleanup(e,"click",()=>this.handlePrevBtnClick()),o&&this.addEventListenerWithCleanup(o,"click",()=>this.handleEndTour())}setupWindowEventListners(){const t=P(this.updatePopover.bind(this)),e=P(this.updateOverlayPosition.bind(this));this.addEventListenerWithCleanup(window,"resize",()=>t()),this.addEventListenerWithCleanup(window,"scroll",()=>e()),this.addEventListenerWithCleanup(window,"onEnd",()=>{this.handleEndTour()}),this.addEventListenerWithCleanup(window,"onStart",()=>this.start())}start(){this.overlay.mount(),this.popover.mount(),this.setupPopoverBtnListeners(),this.updatePopover()}distroy(){this.popover&&this.popover.destroy(),this.overlay&&this.overlay.distroy(),this.removeEventListeners()}}class V{constructor(t,e){a(this,"tourConfig");a(this,"steps");const{controllerConfig:{steps:o},tourConfig:i}=t;e&&C.overrideTheme(e),this.steps=o,this.tourConfig=i}initTour(){m.initInstance({steps:this.steps}),new W(this.tourConfig)}async start(){m.getInstance().isTourStarted||await m.getInstance().start()}get isTourActive(){try{return m.getInstance().isTourActive}catch{return!1}}distroy(){m.getInstance().endTour()}}h.POPOVERIDS=d,h.POPOVER_POSITION_CONSTANT=c,h.Tour=V,h.TourController=m,h.TourState=L,h.bringInView=u,h.debounce=P,h.hasHorizontalScroll=A,h.hasVerticalScroll=N,h.isElementInView=f,h.popover_positions=k,h.waitForElement=M,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
